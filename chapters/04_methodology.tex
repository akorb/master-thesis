% !TeX root = ../main.tex
% Add the above to each chapter to make compiling the PDF easier in some editors.

\chapter{Methodology}\label{chapter:methodology}

\section{Terminology}

% FWID vs. TCI
% Prover/Verifier (in many earlier papers) vs. Attester/Verifier/Relying Party (RFC)

\section{Architectural overview}

% S-RTM = DICE

% EK = AK: Takes on both roles. Endorsement key always represents identity, therefore, we lose privacy. Later an approach with privacy is presented.
% However, we don't require a privacy CA, but instead trust the manufacturer of our trust anchor directly (DICE), which is sufficient for our approach.

% EK does not represent devices' identity anymore, but DICEs' DeviceCert does.
% Lifetime of EK is bound to the exact software versions of the fTPM including all underlying firmware

\section{Chaining DICE and TPM certificate infrastructure}

\section{Provisioning process}

% To summarize, attestation key provisioning must ensure that only valid attestation key material is established in Attesters [RFC 9334]

\section{Attestation process}

% Check also for revocation of manufacturer cert

\section{Updating the fTPM}

We consider it as critical that the \ac{fTPM} is updatable. This is due to the history of \acp{fTPM} showing vulnerabilities which have been patched consequently. % cite... all from background probably

Our \ac{fTPM} can be only updated with the system shut down. This is due to the required out-of-band signing procedure of trusted applications before being deployed. This also  with while system is shut down. This ensures that the TCI part of the EKcert generated at boot-time does not become obsolete, in other words, keeps representing the state of the currently running fTPM.

% Clear data

To protect against downgrade attacks:
NV data is encrypted/integrity with AESP
Encryption required to ensure confidentiality
AESP used to also ensure integrity
This is required since also the cipher text of the NV could be modified, which might change security critical information.
Encryption-only would not prohibit that.
As soon as an integrity violation is detected, the \ac{fTPM} is fully reset, effectively invalidating all previously stored data.
Note that an attacker could thereby easily trigger a data loss.
This has to avoided by integrating the good-practices with working with a \ac{TPM}, which includes having secrets stored also elsewhere. % Maybe cite something, I feel like Microsoft has something for that
This introduces storage and memory overhead.
Processing overhead only slightly, since the data is already decrypted during start-time, which happens only once at boot time, and then later data is encrypted only while it is stored, which happens only ... % TODO: When s it happen? I remember there were not many places in the code where storing of the NV onto the persistent storage is triggered. 
Hence, there is no performance penalty during common uses of a \ac{TPM}, e.g., key creation.

% Add layered figure which shows that the hard drive never sees decrypted data, but only the secure memory. Important because data can be stored in NW.
This might seem redundant because of the storage protection of for example TrustZone, but this does not protect against downgrade attacks. With our approach, the access to the data is bound to the exact identity of the fTPM including all underlying firmware.

So, our protection additionally protects data-at-rest, while the data-at-use is protected by the TEE's secure memory, i.e., the memory isolation from the normal world.



\section{Privacy}

% Maybe: The certificates would need to be encrypted as well, as they contain the TCI values, potentially identifying the device
